@model KEKChat.Models.MessageTextModel
@{
    ViewBag.Title = "KEKChat";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

@section CustomCss{
    <link href="~/Content/Chat.css" rel="stylesheet" type="text/css" />
}

<div class="chat" id="chatView">
    
</div>

<script>
    var messageCount = 0;

    function loadPartialView() {
        $.ajax(
        {
            url: "@Url.Action("GetMessages", "Home")",
            type: 'GET',
            dataType: 'html', 
            success: function (result)
                     {
                        $('#chatView').html(result);

                        if (document.getElementById("chatView").childElementCount > messageCount) {
                            var element = document.getElementById("chatView");
                            element.scrollTop = element.scrollHeight;
                        }

                        messageCount = document.getElementById("chatView").childElementCount;
            }
        }
        );
    }

    $(function() {
       loadPartialView();

       window.setInterval("loadPartialView()", 200);
    });
</script>

<div class="chatbox" id="chatBox">
    @using (Html.BeginForm("SendMessage", "Home", FormMethod.Post, new { @style = "height:100%;", @id = "MainForm" }))
    {
        @Html.EditorFor(model => model.Text, new { htmlAttributes = new { @class = "chat-input", @autofocus = "", id = "textArea" } })
        <button type="submit" runat="server" class="message-button" id="sendButton">Send</button>
    }
</div>

<script>
    document.getElementById('textArea').addEventListener('keydown', function (event) {
        if (event.which === 13 && event.shiftKey) {
            return false;
        }
        else if (event.which === 13) {
            event.preventDefault();
            document.getElementById('sendButton').click();
            return true;
        }
    });
</script>